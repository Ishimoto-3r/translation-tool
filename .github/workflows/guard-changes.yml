name: guard-changes

on:
  pull_request:

jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - name: Check forbidden files
        uses: actions/github-script@v7
        with:
          script: |
            const forbiddenExt = ['.md'];
            const allowed = [
              'pdftranslate.html',
              'pdftranslate.js',
              'api/pdftranslate.js'
            ];

            const files = await github.paginate(
              github.rest.pulls.listFiles,
              {
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: context.payload.pull_request.number,
              }
            );

            for (const f of files) {
              if (forbiddenExt.some(ext => f.filename.endsWith(ext))) {
                core.setFailed(`Forbidden file detected: ${f.filename}`);
              }
              if (!allowed.includes(f.filename)) {
                core.setFailed(`File not allowed in this PR: ${f.filename}`);
              }
            }

 
