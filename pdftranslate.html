<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>検品用マニュアル翻訳</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // PDF.js worker設定
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/ui-utils.js" defer></script>
    <script src="pdftranslate.js" defer></script>

    <style>
        /* Tailwindと共存させるための調整 */
        body {
            /* style.cssのbodyスタイルを適用 */
            background-color: #f3f4f6;
            color: #1f2937;
        }

        /* プレビューエリアなど固有のスタイルは維持 */
        .page-preview-item {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 8px;
            background: #fff;
            transition: all 0.2s;
        }

        .page-preview-item:hover {
            border-color: #3b82f6;
        }

        .page-preview-item.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .page-preview-canvas {
            width: 100%;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* ナビゲーションバー (navigation.jsが生成するが、style.cssと競合しないように) */
    </style>
</head>

<body class="bg-gray-100 text-gray-800">
    <script src="/navigation.js" defer></script>

    <div id="toast-container"></div>


    <!-- overlay -->
    <div id="overlay" class="overlay" aria-hidden="true">
        <div class="overlay-card">
            <div class="flex items-center justify-between gap-3">
                <div class="font-bold text-lg" id="overlayTitle">処理中</div>
                <div class="text-xs text-gray-300 mono" id="overlayStep">...</div>
            </div>
            <div class="mt-3 text-sm text-gray-200 leading-relaxed" id="overlayMsg">処理しています。画面は操作できません。</div>
            <div class="mt-4 w-full bg-gray-700/60 rounded-full h-2 overflow-hidden">
                <div id="overlayBar" class="h-2 bg-blue-400 w-1/3 rounded-full"></div>
            </div>
            <div class="mt-3 text-xs text-gray-300 mono" id="overlayHint"></div>
        </div>
    </div>

    <main class="container">
        <!-- class="container" applies max-width and styling from style.css -->
        <div class="bg-white rounded-2xl shadow p-6 border border-gray-200" style="padding: 2rem;">
            <h1 class="text-2xl font-bold mb-4" style="text-align:center;">検品用マニュアル翻訳</h1>

            <!-- 入力 -->
            <section class="mt-6">
                <!-- Tailwindのクラスを残しつつ、構造を維持 -->
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-6">
                    <div class="font-bold text-base mb-2">入力</div>
                    <div class="text-xs text-gray-600 mt-1">※ PDFファイルまたはURLのどちらか一方を指定してください</div>

                    <div id="dropzone"
                        class="mt-4 border-2 border-dashed border-gray-300 rounded-xl p-8 bg-white hover:bg-gray-50 transition cursor-pointer">
                        <div class="text-center">
                            <div class="font-semibold text-lg">PDFファイルを選択してください</div>
                            <div class="mt-2 text-sm text-gray-500">ここにファイルをドロップ（またはクリックで選択）</div>
                        </div>
                        <input id="pdfInput" type="file" accept="application/pdf" class="hidden" />
                    </div>

                    <!-- URL入力 -->
                    <div class="mt-4 form-group">
                        <label class="form-label block text-sm font-bold">マニュアルURL</label>
                        <div class="text-xs text-gray-500 mt-1 mb-1">
                            <a href="https://3rrr-btob.jp/manual/" target="_blank" rel="noopener noreferrer"
                                class="text-blue-600 underline">マニュアル検索はこちら</a>
                        </div>
                        <input id="pdfUrlInput" type="url" class="form-control"
                            placeholder="例：https://www.example.com/manual" />
                    </div>

                    <div class="mt-6 form-group">
                        <label class="form-label block text-sm font-bold mb-2">翻訳方向</label>
                        <select id="directionSelect" class="form-control">
                            <option value="ja-zh" selected>日本語 → 中国語</option>
                            <option value="ja-en">日本語 → 英語</option>
                            <option value="ja-ko">日本語 → 韓国語</option>
                        </select>
                    </div>

                    <!-- プレビューエリア -->
                    <div id="previewSection" class="mt-6 hidden">
                        <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                            <h2 class="text-xl font-bold text-gray-800">ページ選択 / 範囲選択</h2>

                            <!-- モード切替 -->
                            <div class="flex bg-gray-100 p-1 rounded-lg">
                                <button id="modePage"
                                    class="px-4 py-2 rounded-md text-sm font-bold bg-white shadow-sm text-blue-600 transition">
                                    ページ選択
                                </button>
                                <button id="modeCrop"
                                    class="px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:text-gray-700 transition">
                                    範囲選択（トリミング）
                                </button>
                            </div>

                            <!-- ページ選択用コントロール -->
                            <div id="pageSelectionControls" class="flex items-center gap-3">
                                <span id="selectionCount" class="text-sm font-bold text-blue-600">0ページ 選択中</span>
                                <button id="btnSelectAll" class="btn btn-secondary btn-sm">すべて選択</button>
                                <button id="btnDeselectAll" class="btn btn-secondary btn-sm">すべて解除</button>
                            </div>
                        </div>

                        <!-- 範囲選択モード用ガイダンス -->
                        <div id="cropInstruction"
                            class="hidden mb-4 p-4 bg-blue-50 text-blue-800 text-sm rounded-lg border border-blue-200 shadow-sm flex items-start gap-3">
                            <div class="text-blue-500 mt-0.5"><i class="fas fa-mouse-pointer"></i></div>
                            <div>
                                <div class="font-bold mb-1">範囲選択モードの使い方</div>
                                <ul class="list-disc list-inside space-y-1 text-xs">
                                    <li>プレビュー画像をドラッグして、翻訳したいエリアを囲んでください（赤枠で表示されます）。</li>
                                    <li>見開きページの「左側だけ」「右側だけ」を切り抜いたり、3つ折りの特定部分だけを指定できます。</li>
                                    <li>枠の右下の「×」で削除できます。</li>
                                </ul>
                            </div>
                        </div>
                        <div id="previewContainer"
                            class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-h-[700px] overflow-y-auto p-4 bg-white border border-gray-200 rounded-xl">
                            <!-- JavaScript でプレビューを動的に追加 -->
                        </div>
                    </div>

                    <div class="mt-8 flex items-center justify-end">
                        <button id="btnExecute" class="btn btn-primary font-bold transition w-full md:w-auto px-8">
                            翻訳を実行する
                        </button>
                    </div>
                </div>
            </section>

            <!-- 結果表示 -->
            <section class="mt-8">
                <div class="bg-gray-50 border border-gray-200 rounded-2xl p-6">
                    <div class="font-bold text-base mb-2">結果表示</div>
                    <div id="resultArea"
                        class="mt-4 p-8 bg-white border border-gray-200 rounded-xl min-h-[150px] flex items-center justify-center text-gray-500 border-dashed">
                        ここに翻訳後のファイルが表示されます
                    </div>
                </div>
            </section>

            <!-- エラー表示 -->
            <section class="mt-4">
                <div id="errorBox" class="hidden border border-red-200 bg-red-50 text-red-800 rounded-xl p-3 text-sm">
                </div>
            </section>
        </div>
    </main>
</body>

</html>